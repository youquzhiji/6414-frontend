var z=Object.defineProperty;var V=(s,t,e)=>t in s?z(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e;var i=(s,t,e)=>(V(s,typeof t!="symbol"?t+"":t,e),e);import{d as D,c as L,a as d,b as g,w as b,F as P,e as v,r as C,o as k,f as R,s as U,t as T,n as $,V as W,E as A,p as j,g as q,h as G,i as K,j as J,k as Q}from"./vendor.50387be1.js";const X=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))o(n);new MutationObserver(n=>{for(const a of n)if(a.type==="childList")for(const r of a.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&o(r)}).observe(document,{childList:!0,subtree:!0});function e(n){const a={};return n.integrity&&(a.integrity=n.integrity),n.referrerpolicy&&(a.referrerPolicy=n.referrerpolicy),n.crossorigin==="use-credentials"?a.credentials="include":n.crossorigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function o(n){if(n.ep)return;n.ep=!0;const a=e(n);fetch(n.href,a)}};X();const Y=v("Home"),Z=v(" | "),tt=v("About"),et=D({setup(s){return(t,e)=>{const o=C("router-link"),n=C("router-view");return k(),L(P,null,[d("p",null,[g(o,{class:"rlink",to:"/"},{default:b(()=>[Y]),_:1}),Z,g(o,{class:"rlink",to:"/about"},{default:b(()=>[tt]),_:1})]),g(n)],64)}}});class F{constructor(t){i(this,"el");i(this,"ctx");i(this,"w");i(this,"h");this.el=t,this.ctx=t.getContext("2d");const e=window.getComputedStyle(t);this.w=t.width=parseInt(e.width.replace("px","")),this.h=t.height=parseInt(e.height.replace("px",""))}}function st(s){let t=0;for(let e=0;e<s.length;e++)t+=s[e];return t}function ot(s){return st(s)/s.length}function _(s){let t=s[0],e=s[0];for(let o=0;o<s.length;o++)s[o]<t&&(t=s[o]),s[o]>e&&(e=s[o]);return[t,e]}class nt{constructor(t,e){i(this,"res");i(this,"r");i(this,"g");i(this,"b");this.res=e,this.r=new Uint8Array(e+1),this.g=new Uint8Array(e+1),this.b=new Uint8Array(e+1);for(let o=0;o<=e;o++)[this.r[o],this.g[o],this.b[o]]=t(o/e).rgb()}get(t){const e=Math.round(t*this.res);return[this.r[e],this.g[e],this.b[e]]}}const at="pink";class rt extends F{drawAudio(t){const e=t.getChannelData(0),o=t.length/this.w,n=this.h/2;for(let a=0;a<this.w;a++){const[r,l]=_(e.subarray(a*o,(a+1)*o));this.ctx.strokeStyle=at,this.ctx.moveTo(a,n-l*n),this.ctx.lineTo(a,n-r*n),this.ctx.stroke()}}}async function it(s,t=512,e=2048){const o=U.stft(T(s),e,t).abs(),n=await o.data(),a=[],[r,l]=o.shape;for(let u=0;u<r;u++)a.push(n.subarray(u*l,(u+1)*l));return a}class ct extends F{async drawAudio(t){let e=performance.now();const o=await it(t.getChannelData(0));console.log(`stft calculation done: ${performance.now()-e} ms`),e=performance.now(),this.el.width=this.w=o.length;const[n,a]=_(o.flatMap(c=>_(c))),r=a-n,l=o[0].length,u=Math.log2(l),[$t,I]=[l/this.h,u/this.h],M=c=>Math.floor(Math.pow(2,c*I)),w=Array.from(Array(this.h).keys()).map(c=>M(c)),y=this.ctx.createImageData(this.w,this.h),p=y.data,O=this.w*4,H=new nt(R.scale(["#000","#4F1879","#B43A78","#F98766","#FCFAC0"]),1e3);for(let c=0;c<this.w;c++){const N=o[c],E=c*4;for(let h=0;h<this.h;h++){const x=w[h],m=w[h+1],B=N.subarray(x,m==x?m+1:m),f=(this.h-h)*O+E;[p[f],p[f+1],p[f+2]]=H.get((ot(B)-n)/r),p[f+3]=255}}this.ctx.putImageData(y,0,0),console.log(`drawing done: ${performance.now()-e} ms`)}}var lt=(s,t)=>{const e=s.__vccOpts||s;for(const[o,n]of t)e[o]=n;return e};class dt extends W{constructor(){super(...arguments);i(this,"waveformCanvas");i(this,"spectrogramCanvas");i(this,"audio",null)}mounted(){this.waveformCanvas=new rt(this.$refs.wfCanvas),this.spectrogramCanvas=new ct(this.$refs.spCanvas)}async onDrop(t){if(t.preventDefault(),!(t.dataTransfer&&t.dataTransfer.items))return;const e=t.dataTransfer.items.length;if(e>1)return A.error(`Only one file can be analyzed at a time, you dropped ${e}`);const o=t.dataTransfer.items[0];if(o.kind!="file")return A.error(`Error: The item dropped must be a file, not a ${o.kind}`);const n=o.getAsFile();console.log(`File Dropped: ${n.name}
- LastModified: ${n.lastModified}
- Size: ${n.size}
- Type: ${n.type}`);const a=await n.arrayBuffer(),r=new AudioContext({sampleRate:16e3});this.audio=await r.decodeAudioData(a);const l=this.audio.getChannelData(0);console.log(`Audio Loaded:
- Sample Rate: ${this.audio.sampleRate} Hz
- Array Length: ${this.audio.length}
- Duration: ${this.audio.duration} sec
- Number of Channels: ${this.audio.numberOfChannels}
`),console.log(l),this.waveformCanvas.drawAudio(this.audio),await this.spectrogramCanvas.drawAudio(this.audio)}}const ut=dt,S=s=>(j("data-v-7c0d7fe8"),s=s(),q(),s),ht={id:"home",ref:"el"},pt=S(()=>d("div",{class:"usage"}," Welcome to the voice training tool [TODO: \u60F3\u4E00\u4E2A\u540D\u5B57] ",-1)),ft=S(()=>d("span",{class:"drop-label"},"Drop Here",-1)),mt=[ft],gt={ref:"wfCanvas"},_t={ref:"spCanvas"},vt={class:"ft-graph",ref:"ft",id:"ft"};function wt(s,t,e,o,n,a){return k(),L("div",ht,[pt,d("div",{class:"drop-box unselectable",onDragover:t[0]||(t[0]=r=>r.preventDefault()),onDrop:t[1]||(t[1]=(...r)=>s.onDrop&&s.onDrop(...r))},mt,32),d("div",{class:"waveform",style:$({visibility:s.audio?"unset":"hidden"})},[d("canvas",gt,null,512)],4),d("div",{class:"spectrogram",style:$({visibility:s.audio?"unset":"hidden"})},[d("canvas",_t,null,512)],4),d("div",vt,null,512)],512)}var yt=lt(ut,[["render",wt],["__scopeId","data-v-7c0d7fe8"]]);const xt=D({setup(s){return T([1,1,1,1,0,0,0,0]).rfft().print(),(e,o)=>" This is an about page. "}}),bt=[{path:"/",name:"Home",component:yt},{path:"/about",name:"About",component:xt}],Ct=G({history:K(),routes:bt});J(et).use(Ct).use(Q).mount("#app");
