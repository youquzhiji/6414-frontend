var B=Object.defineProperty;var z=(s,e,t)=>e in s?B(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t;var i=(s,e,t)=>(z(s,typeof e!="symbol"?e+"":e,t),t);import{d as L,c as _,a as l,b as g,w as C,F as V,r as $,o as v,e as P,s as R,t as k,f as U,n as A,V as W,E as D,p as j,g as q,h as G,i as K,j as J,k as Q}from"./vendor.a2f88026.js";const X=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))o(n);new MutationObserver(n=>{for(const a of n)if(a.type==="childList")for(const r of a.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&o(r)}).observe(document,{childList:!0,subtree:!0});function t(n){const a={};return n.integrity&&(a.integrity=n.integrity),n.referrerpolicy&&(a.referrerPolicy=n.referrerpolicy),n.crossorigin==="use-credentials"?a.credentials="include":n.crossorigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function o(n){if(n.ep)return;n.ep=!0;const a=t(n);fetch(n.href,a)}};X();const Y=l("i",{class:"fa-solid fa-house"},null,-1),Z=l("span",null,"Home",-1),ee=l("i",{class:"fa-solid fa-circle-info"},null,-1),te=l("span",null,"About",-1),se=L({setup(s){return(e,t)=>{const o=$("router-link"),n=$("router-view");return v(),_(V,null,[l("div",{id:"nav",class:"fbox-h fcenter unselectable",onDragstart:t[0]||(t[0]=a=>a.preventDefault())},[g(o,{class:"rlink",to:"/"},{default:C(()=>[Y,Z]),_:1}),g(o,{class:"rlink",to:"/about"},{default:C(()=>[ee,te]),_:1})],32),g(n)],64)}}});class F{constructor(e){i(this,"el");i(this,"ctx");i(this,"w");i(this,"h");this.el=e,this.ctx=e.getContext("2d");const t=window.getComputedStyle(e);this.w=e.width=parseInt(t.width.replace("px","")),this.h=e.height=parseInt(t.height.replace("px",""))}}function oe(s){let e=0;for(let t=0;t<s.length;t++)e+=s[t];return e}function ne(s){return oe(s)/s.length}function w(s){let e=s[0],t=s[0];for(let o=0;o<s.length;o++)s[o]<e&&(e=s[o]),s[o]>t&&(t=s[o]);return[e,t]}class ae{constructor(e,t){i(this,"res");i(this,"r");i(this,"g");i(this,"b");this.res=t,this.r=new Uint8Array(t+1),this.g=new Uint8Array(t+1),this.b=new Uint8Array(t+1);for(let o=0;o<=t;o++)[this.r[o],this.g[o],this.b[o]]=e(o/t).rgb()}get(e){const t=Math.round(e*this.res);return[this.r[t],this.g[t],this.b[t]]}}const re="pink";class ie extends F{drawAudio(e){const t=e.getChannelData(0),o=e.length/this.w,n=this.h/2;for(let a=0;a<this.w;a++){const[r,d]=w(t.subarray(a*o,(a+1)*o));this.ctx.strokeStyle=re,this.ctx.moveTo(a,n-d*n),this.ctx.lineTo(a,n-r*n),this.ctx.stroke()}}}async function ce(s,e=512,t=2048){const o=R.stft(k(s),t,e).abs(),n=await o.data(),a=[],[r,d]=o.shape;for(let u=0;u<r;u++)a.push(n.subarray(u*d,(u+1)*d));return a}class le extends F{async drawAudio(e){let t=performance.now();const o=await ce(e.getChannelData(0));console.log(`stft calculation done: ${performance.now()-t} ms`),t=performance.now(),this.el.width=this.w=o.length;const[n,a]=w(o.flatMap(c=>w(c))),r=a-n,d=o[0].length,u=Math.log2(d),[Ce,T]=[d/this.h,u/this.h],I=c=>Math.floor(Math.pow(2,c*T)),y=Array.from(Array(this.h).keys()).map(c=>I(c)),b=this.ctx.createImageData(this.w,this.h),p=b.data,M=this.w*4,O=new ae(P.scale(["#000","#4F1879","#B43A78","#F98766","#FCFAC0"]),1e3);for(let c=0;c<this.w;c++){const H=o[c],N=c*4;for(let h=0;h<this.h;h++){const x=y[h],m=y[h+1],E=H.subarray(x,m==x?m+1:m),f=(this.h-h)*M+N;[p[f],p[f+1],p[f+2]]=O.get((ne(E)-n)/r),p[f+3]=255}}this.ctx.putImageData(b,0,0),console.log(`drawing done: ${performance.now()-t} ms`)}}var de=(s,e)=>{const t=s.__vccOpts||s;for(const[o,n]of e)t[o]=n;return t};class ue extends W{constructor(){super(...arguments);i(this,"waveformCanvas");i(this,"spectrogramCanvas");i(this,"audio",null)}mounted(){this.waveformCanvas=new ie(this.$refs.wfCanvas),this.spectrogramCanvas=new le(this.$refs.spCanvas)}async onDrop(e){if(e.preventDefault(),!(e.dataTransfer&&e.dataTransfer.items))return;const t=e.dataTransfer.items.length;if(t>1)return D.error(`Only one file can be analyzed at a time, you dropped ${t}`);const o=e.dataTransfer.items[0];if(o.kind!="file")return D.error(`Error: The item dropped must be a file, not a ${o.kind}`);const n=o.getAsFile();console.log(`File Dropped: ${n.name}
- LastModified: ${n.lastModified}
- Size: ${n.size}
- Type: ${n.type}`);const a=await n.arrayBuffer(),r=new AudioContext({sampleRate:16e3});this.audio=await r.decodeAudioData(a);const d=this.audio.getChannelData(0);console.log(`Audio Loaded:
- Sample Rate: ${this.audio.sampleRate} Hz
- Array Length: ${this.audio.length}
- Duration: ${this.audio.duration} sec
- Number of Channels: ${this.audio.numberOfChannels}
`),console.log(d),this.waveformCanvas.drawAudio(this.audio),await this.spectrogramCanvas.drawAudio(this.audio)}}const he=ue,S=s=>(j("data-v-4bc9d0d8"),s=s(),q(),s),pe={id:"home",ref:"el",class:"fbox-v"},fe=S(()=>l("div",{class:"usage"}," Welcome to the voice training tool [TODO: \u60F3\u4E00\u4E2A\u540D\u5B57] ",-1)),me=S(()=>l("span",{class:"drop-label"},"Drop Here",-1)),ge=[me],_e={ref:"wfCanvas"};function ve(s,e,t,o,n,a){return v(),_("div",pe,[fe,s.audio?U("",!0):(v(),_("div",{key:0,class:"drop-box unselectable",onDragover:e[0]||(e[0]=r=>r.preventDefault()),onDrop:e[1]||(e[1]=(...r)=>s.onDrop&&s.onDrop(...r))},ge,32)),l("div",{class:"waveform",style:A({visibility:s.audio?"unset":"hidden"})},[l("canvas",_e,null,512)],4),l("canvas",{ref:"spCanvas",class:"f-grow1",style:A({visibility:s.audio?"unset":"hidden"})},null,4)],512)}var we=de(he,[["render",ve],["__scopeId","data-v-4bc9d0d8"]]);const ye=L({setup(s){return k([1,1,1,1,0,0,0,0]).rfft().print(),(t,o)=>" This is an about page. "}}),be=[{path:"/",name:"Home",component:we},{path:"/about",name:"About",component:ye}],xe=G({history:K(),routes:be});J(se).use(xe).use(Q).mount("#app");
